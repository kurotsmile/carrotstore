(function(a){a.fn.ajaxfileupload=function(c){var d={params:{},action:"",onStart:function(){},onComplete:function(e){},onCancel:function(){},validate_extensions:true,valid_extensions:["gif","png","jpg","jpeg","mp3"],submit_button:null};var b=false;if(c){a.extend(d,c)}return this.each(function(){var e=a(this);if(e.data("ajaxUploader-setup")===true){return}e.change(function(){b=false;if(d.submit_button==null){f()}});if(d.submit_button==null){}else{d.submit_button.click(function(i){i.preventDefault();if(!b){f()}})}var f=function(){if(e.val()==""){return d.onCancel.apply(e,[d.params])}var j=e.val().split(".").pop().toLowerCase();if(true===d.validate_extensions&&a.inArray(j,d.valid_extensions)==-1){d.onComplete.apply(e,[{status:false,message:"The select file type is invalid. File must be "+d.valid_extensions.join(", ")+"."},d.params])}else{b=true;h(e);var i=d.onStart.apply(e,[d.params]);if(i!==false){e.parent("form").submit(function(k){k.stopPropagation()}).submit()}else{b=false}}};e.data("ajaxUploader-setup",true);var g=function(m,k){var i,j=a(m).contents().text();try{i=JSON.parse(j)}catch(l){i=j}k.siblings().remove();k.unwrap();b=false;d.onComplete.apply(k,[i,d.params])};var h=function(i){var j="ajaxUploader-iframe-"+Math.round(new Date().getTime()/1000);a("body").after('<iframe width="0" height="0" style="display:none;" name="'+j+'" id="'+j+'"/>');a("#"+j).get(0).onload=function(){g(this,i)};i.wrap(function(){return'<form action="'+d.action+'" method="POST" enctype="multipart/form-data" target="'+j+'" />'}).before(function(){var l,k="";for(l in d.params){var m=d.params[l];if(typeof m==="function"){m=m()}k+='<input type="hidden" name="'+l+'" value="'+m+'" />'}return k})}})}})(jQuery);