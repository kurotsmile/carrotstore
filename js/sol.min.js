(function(d,c,a){var b=function(e,f){this.$originalElement=e;this.options=f;this.metadata=this.$originalElement.data("sol-options")};b.prototype={SOL_OPTION_FORMAT:{type:"option",value:undefined,selected:false,disabled:false,label:undefined,tooltip:undefined,cssClass:""},SOL_OPTIONGROUP_FORMAT:{type:"optiongroup",label:undefined,tooltip:undefined,disabled:false,children:undefined},DATA_KEY:"sol-element",WINDOW_EVENTS_KEY:"sol-window-events",defaults:{data:undefined,name:undefined,texts:{noItemsAvailable:"No entries found",selectAll:"Select all",selectNone:"Select none",quickDelete:"&times;",searchplaceholder:"Click here to search",loadingData:"Still loading data..."},events:{onInitialized:undefined,onRendered:undefined,onOpen:undefined,onClose:undefined,onChange:undefined,onScroll:function(){var g=this.$input.offset().top-this.config.scrollTarget.scrollTop()+this.$input.outerHeight(false),h=this.$selectionContainer.outerHeight(false),i=g+h,j=this.config.displayContainerAboveInput||a.documentElement.clientHeight-this.config.scrollTarget.scrollTop()<i,e=this.$innerContainer.outerWidth(false)-parseInt(this.$selectionContainer.css("border-left-width"),10)-parseInt(this.$selectionContainer.css("border-right-width"),10);if(j){g=this.$input.offset().top-h-this.config.scrollTarget.scrollTop()+parseInt(this.$selectionContainer.css("border-bottom-width"),10);this.$container.removeClass("sol-selection-bottom").addClass("sol-selection-top")}else{this.$container.removeClass("sol-selection-top").addClass("sol-selection-bottom")}if(this.$innerContainer.css("display")!=="block"){e=e*1.2}else{var f=j?"border-bottom-right-radius":"border-top-right-radius";this.$selectionContainer.css(f,"initial");if(this.$actionButtons){this.$actionButtons.css(f,"initial")}}this.$selectionContainer.css("top",Math.floor(g)).css("left",Math.floor(this.$container.offset().left)).css("width",e);this.config.displayContainerAboveInput=j}},selectAllMaxItemsThreshold:30,showSelectAll:function(){return this.config.multiple&&this.config.selectAllMaxItemsThreshold&&this.items&&this.items.length<=this.config.selectAllMaxItemsThreshold},useBracketParameters:false,multiple:undefined,showSelectionBelowList:false,allowNullSelection:false,scrollTarget:undefined,maxHeight:undefined,converter:undefined,asyncBatchSize:300},init:function(){this.config=d.extend(true,{},this.defaults,this.options,this.metadata);var e=this._getNameAttribute(),f=this;if(!e){this._showErrorLabel("name attribute is required");return}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}this.config.multiple=this.config.multiple||this.$originalElement.attr("multiple");if(!this.config.scrollTarget){this.config.scrollTarget=d(c)}this._registerWindowEventsIfNeccessary();this._initializeUiElements();this._initializeInputEvents();setTimeout(function(){f._initializeData();f.$originalElement.data(f.DATA_KEY,f).removeAttr("name").data("sol-name",e)},0);this.$originalElement.hide();this.$container.css("visibility","initial").show();return this},_getNameAttribute:function(){return this.config.name||this.$originalElement.data("sol-name")||this.$originalElement.attr("name")},_showErrorLabel:function(f){var e=d('<div style="color: red; font-weight: bold;" />').html(f);if(!this.$container){e.insertAfter(this.$originalElement)}else{this.$container.append(e)}},_registerWindowEventsIfNeccessary:function(){if(!c[this.WINDOW_EVENTS_KEY]){d(a).click(function(h){var i=d(h.target),g=i.closest(".sol-selection-container"),f=i.closest(".sol-inner-container"),e;if(f.length){e=f.first().parent(".sol-container")}else{if(g.length){e=g.first().parent(".sol-container")}}d(".sol-active").not(e).each(function(j,k){d(k).data(b.prototype.DATA_KEY).close()})});c[this.WINDOW_EVENTS_KEY]=true}},_initializeUiElements:function(){var g=this;this.internalScrollWrapper=function(){if(d.isFunction(g.config.events.onScroll)){g.config.events.onScroll.call(g)}};this.$input=d('<input type="text"/>').attr("placeholder",this.config.texts.searchplaceholder);this.$noResultsItem=d('<div class="sol-no-results"/>').html(this.config.texts.noItemsAvailable).hide();this.$loadingData=d('<div class="sol-loading-data">').html(this.config.texts.loadingData);this.$caret=d('<div class="sol-caret-container"><b class="sol-caret"/></div>').click(function(i){g.toggle();i.preventDefault();return false});var f=d('<div class="sol-input-container"/>').append(this.$input);this.$innerContainer=d('<div class="sol-inner-container"/>').append(f).append(this.$caret);this.$selection=d('<div class="sol-selection"/>');this.$selectionContainer=d('<div class="sol-selection-container"/>').append(this.$noResultsItem).append(this.$loadingData).append(this.$selection);this.$container=d('<div class="sol-container"/>').hide().data(this.DATA_KEY,this).append(this.$selectionContainer).append(this.$innerContainer).insertBefore(this.$originalElement);this.$showSelectionContainer=d('<div class="sol-current-selection"/>');if(this.config.showSelectionBelowList){this.$showSelectionContainer.insertAfter(this.$innerContainer)}else{this.$showSelectionContainer.insertBefore(this.$innerContainer)}if(this.config.maxHeight){this.$selection.css("max-height",this.config.maxHeight)}var l=this.$originalElement.attr("class"),k=this.$originalElement.attr("style"),j=[],e=[];if(l&&l.length>0){j=l.split(/\s+/);for(var h=0;h<j.length;h++){this.$container.addClass(j[h])}}if(k&&k.length>0){e=k.split(/\;/);for(var h=0;h<e.length;h++){var m=e[h].split(/\s*\:\s*/g);if(m.length===2){if(m[0].toLowerCase().indexOf("height")>=0){this.$innerContainer.css(m[0].trim(),m[1].trim())}else{this.$container.css(m[0].trim(),m[1].trim())}}}}if(this.$originalElement.css("display")!=="block"){this.$container.css("width",this._getActualCssPropertyValue(this.$originalElement,"width"))}if(d.isFunction(this.config.events.onRendered)){this.config.events.onRendered.call(this,this)}},_getActualCssPropertyValue:function(e,f){var h=e.get(0),g=e.css("display");e.css("display","none");if(h.currentStyle){return h.currentStyle[f]}else{if(c.getComputedStyle){return a.defaultView.getComputedStyle(h,null).getPropertyValue(f)}}e.css("display",g);return e.css(f)},_initializeInputEvents:function(){var f=this,e=this.$input.parents("form").first();if(e&&e.length===1&&!e.data(this.WINDOW_EVENTS_KEY)){var g=function(){var h=[];e.find(".sol-option input").each(function(k,l){var j=d(l),i=j.data("sol-item").selected;if(j.prop("checked")!==i){j.prop("checked",i).trigger("sol-change",true);h.push(j)}});if(h.length>0&&d.isFunction(f.config.events.onChange)){f.config.events.onChange.call(f,f,h)}};e.on("reset",function(h){g.call(f);setTimeout(function(){g.call(f)},100)});e.data(this.WINDOW_EVENTS_KEY,true)}this.$input.focus(function(){f.open()}).on("propertychange input",function(i){var h=true;if(i.type=="propertychange"){h=i.originalEvent.propertyName.toLowerCase()=="value"}if(h){f._applySearchTermFilter()}});this.$container.on("keydown",function(m){var l=m.keyCode;if(!f.$noResultsItem.is(":visible")){var n,j,k,i=false,o=f.$selection.find(".sol-option:visible");if(l===40||l===38){f._setKeyBoardNavigationMode(true);n=f.$selection.find(".sol-option.keyboard-selection");k=(l===38)?-1:1;var h=o.index(n)+k;if(h<0){h=o.length-1}else{if(h>=o.length){h=0}}n.removeClass("keyboard-selection");j=d(o[h]).addClass("keyboard-selection");f.$selection.scrollTop(f.$selection.scrollTop()+j.position().top);i=true}else{if(f.keyboardNavigationMode===true&&l===32){n=f.$selection.find(".sol-option.keyboard-selection input");n.prop("checked",!n.prop("checked")).trigger("change");i=true}}if(i){m.preventDefault();return false}}}).on("keyup",function(i){var h=i.keyCode;if(h===27){if(f.keyboardNavigationMode===true){f._setKeyBoardNavigationMode(false)}else{if(f.$input.val()===""){f.$caret.trigger("click");f.$input.trigger("blur")}else{f.$input.val("").trigger("input")}}}else{if(h===16||h===17||h===18||h===20){return}}})},_setKeyBoardNavigationMode:function(e){if(e){this.keyboardNavigationMode=true;this.$selection.addClass("sol-keyboard-navigation")}else{this.keyboardNavigationMode=false;this.$selection.find(".sol-option.keyboard-selection");this.$selection.removeClass("sol-keyboard-navigation");this.$selectionContainer.find(".sol-option.keyboard-selection").removeClass("keyboard-selection");this.$selection.scrollTop(0)}},_applySearchTermFilter:function(){if(!this.items||this.items.length===0){return}var e=this.$input.val(),f=(e||"").toLowerCase();this.$selectionContainer.find(".sol-filtered-search").removeClass("sol-filtered-search");this._setNoResultsItemVisible(false);if(f.trim().length>0){this._findTerms(this.items,f)}if(d.isFunction(this.config.events.onScroll)){this.config.events.onScroll.call(this)}},_findTerms:function(e,g){if(!e||!d.isArray(e)||e.length===0){return}var f=this;this._setKeyBoardNavigationMode(false);d.each(e,function(i,j){if(j.type==="option"){var h=j.displayElement,k=(j.label+" "+j.tooltip).trim().toLowerCase();if(k.indexOf(g)===-1){h.addClass("sol-filtered-search")}}else{f._findTerms(j.children,g);var l=j.displayElement.find(".sol-option:not(.sol-filtered-search)");if(l.length===0){j.displayElement.addClass("sol-filtered-search")}}});this._setNoResultsItemVisible(this.$selectionContainer.find(".sol-option:not(.sol-filtered-search)").length===0)},_initializeData:function(){if(!this.config.data){this.items=this._detectDataFromOriginalElement()}else{if(d.isFunction(this.config.data)){this.items=this._fetchDataFromFunction(this.config.data)}else{if(d.isArray(this.config.data)){this.items=this._fetchDataFromArray(this.config.data)}else{if(typeof this.config.data===(typeof"a string")){this._loadItemsFromUrl(this.config.data)}else{this._showErrorLabel("Unknown data type")}}}}if(this.items){this._processDataItems(this.items)}},_detectDataFromOriginalElement:function(){if(this.$originalElement.prop("tagName").toLowerCase()==="select"){var f=this,e=[];d.each(this.$originalElement.children(),function(i,k){var h=d(k),j=h.prop("tagName").toLowerCase(),l;if(j==="option"){l=f._processSelectOption(h);if(l){e.push(l)}}else{if(j==="optgroup"){l=f._processSelectOptgroup(h);if(l){e.push(l)}}else{f._showErrorLabel("Invalid element found in select: "+j+". Only option and optgroup are allowed")}}});return this._invokeConverterIfNeccessary(e)}else{if(this.$originalElement.data("sol-data")){var g=this.$originalElement.data("sol-data");return this._invokeConverterIfNeccessary(g)}else{this._showErrorLabel('Could not determine data from original element. Must be a select or data must be provided as data-sol-data="" attribute')}}},_processSelectOption:function(e){return d.extend({},this.SOL_OPTION_FORMAT,{value:e.val(),selected:e.prop("selected"),disabled:e.prop("disabled"),cssClass:e.attr("class"),label:e.html(),tooltip:e.attr("title"),element:e})},_processSelectOptgroup:function(f){var h=this,g=d.extend({},this.SOL_OPTIONGROUP_FORMAT,{label:f.attr("label"),tooltip:f.attr("title"),disabled:f.prop("disabled"),children:[]}),e=f.children("option");d.each(e,function(j,k){var l=d(k),i=h._processSelectOption(l);if(g.disabled){i.disabled=true}g.children.push(i)});return g},_fetchDataFromFunction:function(e){return this._invokeConverterIfNeccessary(e(this))},_fetchDataFromArray:function(e){return this._invokeConverterIfNeccessary(e)},_loadItemsFromUrl:function(f){var e=this;d.ajax(f,{success:function(g){e.items=e._invokeConverterIfNeccessary(g);if(e.items){e._processDataItems(e.items)}},error:function(i,g,h){e._showErrorLabel("Error loading from url "+f+": "+h)}})},_invokeConverterIfNeccessary:function(e){if(d.isFunction(this.config.converter)){return this.config.converter.call(this,this,e)}return e},_processDataItems:function(i){if(!i){this._showErrorLabel("Data items not present. Maybe the converter did not return any values");return}if(i.length===0){this._setNoResultsItemVisible(true);this.$loadingData.remove();return}var g=this,f=0,e=function(){this.$loadingData.remove();this._initializeSelectAll();if(d.isFunction(this.config.events.onInitialized)){this.config.events.onInitialized.call(this,this,i)}},h=function(){var j=0,k;while(j++<g.config.asyncBatchSize&&f<i.length){k=i[f++];if(k.type===g.SOL_OPTION_FORMAT.type){g._renderOption(k)}else{if(k.type===g.SOL_OPTIONGROUP_FORMAT.type){g._renderOptiongroup(k)}else{g._showErrorLabel("Invalid item type found "+k.type);return}}}if(f>=i.length){e.call(g)}else{setTimeout(h,0)}};h.call(this)},_renderOption:function(f,k){var m=this,g=k||this.$selection,l,e=d('<div class="sol-label-text"/>').html(f.label.trim().length===0?"&nbsp;":f.label).addClass(f.cssClass),j,i,h=this._getNameAttribute();if(this.config.multiple){l=d('<input type="checkbox" class="sol-checkbox"/>');if(this.config.useBracketParameters){h+="[]"}}else{l=d('<input type="radio" class="sol-radio"/>').on("change",function(){m.$selectionContainer.find('input[type="radio"][name="'+h+'"]').not(d(this)).trigger("sol-deselect")}).on("sol-deselect",function(){m._removeSelectionDisplayItem(d(this))})}l.on("change",function(o,n){d(this).trigger("sol-change",n)}).on("sol-change",function(o,n){m._selectionChange(d(this),n)}).data("sol-item",f).prop("checked",f.selected).prop("disabled",f.disabled).attr("name",h).val(f.value);j=d('<label class="sol-label"/>').attr("title",f.tooltip).append(l).append(e);i=d('<div class="sol-option"/>').append(j);f.displayElement=i;g.append(i);if(f.selected){this._addSelectionDisplayItem(l)}},_renderOptiongroup:function(g){var f=this,e=d('<div class="sol-optiongroup-label"/>').attr("title",g.tooltip).html(g.label),h=d('<div class="sol-optiongroup"/>').append(e);if(g.disabled){h.addClass("disabled")}if(d.isArray(g.children)){d.each(g.children,function(i,j){f._renderOption(j,h)})}g.displayElement=h;this.$selection.append(h)},_initializeSelectAll:function(){if(this.config.showSelectAll===true||(d.isFunction(this.config.showSelectAll)&&this.config.showSelectAll.call(this))){var e=this,g=d('<a href="#" class="sol-deselect-all"/>').html(this.config.texts.selectNone).click(function(h){e.deselectAll();h.preventDefault();return false}),f=d('<a href="#" class="sol-select-all"/>').html(this.config.texts.selectAll).click(function(h){e.selectAll();h.preventDefault();return false});this.$actionButtons=d('<div class="sol-action-buttons"/>').append(f).append(g).append('<div class="sol-clearfix"/>');this.$selectionContainer.prepend(this.$actionButtons)}},_selectionChange:function(g,f){if(this.$originalElement&&this.$originalElement.prop("tagName").toLowerCase()==="select"){var e=this;this.$originalElement.find("option").each(function(h,j){var i=d(j);if(i.val()===g.val()){i.prop("selected",g.prop("checked"));e.$originalElement.trigger("change");return}})}if(g.prop("checked")){this._addSelectionDisplayItem(g)}else{this._removeSelectionDisplayItem(g)}if(this.config.multiple){this.config.scrollTarget.trigger("scroll")}else{this.close()}if(!f&&d.isFunction(this.config.events.onChange)){this.config.events.onChange.call(this,this,g)}},_addSelectionDisplayItem:function(f){var h=f.data("sol-item"),e=h.displaySelectionItem,g;if(!e){g=d('<span class="sol-selected-display-item-text" />').html(h.label);e=d('<div class="sol-selected-display-item"/>').append(g).attr("title",h.tooltip).appendTo(this.$showSelectionContainer);if((this.config.multiple||this.config.allowNullSelection)&&!f.prop("disabled")){d('<span class="sol-quick-delete"/>').html(this.config.texts.quickDelete).click(function(){f.prop("checked",false).trigger("change")}).prependTo(e)}h.displaySelectionItem=e}},_removeSelectionDisplayItem:function(f){var g=f.data("sol-item"),e=g.displaySelectionItem;if(e){e.remove();g.displaySelectionItem=undefined}},_setNoResultsItemVisible:function(e){if(e){this.$noResultsItem.show();this.$selection.hide();if(this.$actionButtons){this.$actionButtons.hide()}}else{this.$noResultsItem.hide();this.$selection.show();if(this.$actionButtons){this.$actionButtons.show()}}},isOpen:function(){return this.$container.hasClass("sol-active")},isClosed:function(){return !this.isOpen()},toggle:function(){if(this.isOpen()){this.close()}else{this.open()}},open:function(){if(this.isClosed()){this.$container.addClass("sol-active");this.config.scrollTarget.bind("scroll",this.internalScrollWrapper).trigger("scroll");d(c).on("resize",this.internalScrollWrapper);if(d.isFunction(this.config.events.onOpen)){this.config.events.onOpen.call(this,this)}}},close:function(){if(this.isOpen()){this._setKeyBoardNavigationMode(false);this.$container.removeClass("sol-active");this.config.scrollTarget.unbind("scroll",this.internalScrollWrapper);d(c).off("resize");this.$input.val("");this._applySearchTermFilter();this.config.displayContainerAboveInput=undefined;if(d.isFunction(this.config.events.onClose)){this.config.events.onClose.call(this,this)}}},selectAll:function(){if(this.config.multiple){var e=this.$selectionContainer.find('input[type="checkbox"]:not([disabled], :checked)').prop("checked",true).trigger("change",true);this.close();if(d.isFunction(this.config.events.onChange)){this.config.events.onChange.call(this,this,e)}}},deselectAll:function(){if(this.config.multiple){var e=this.$selectionContainer.find('input[type="checkbox"]:not([disabled]):checked').prop("checked",false).trigger("change",true);this.close();if(d.isFunction(this.config.events.onChange)){this.config.events.onChange.call(this,this,e)}}},getSelection:function(){return this.$selection.find("input:checked")}};b.defaults=b.prototype.defaults;c.SearchableOptionList=b;d.fn.searchableOptionList=function(f){var e=[];this.each(function(){var g=d(this),i=g.data(b.prototype.DATA_KEY);if(i){e.push(i)}else{var h=new b(g,f);e.push(h);setTimeout(function(){h.init()},0)}});if(e.length===1){return e[0]}return e}}(jQuery,window,document));