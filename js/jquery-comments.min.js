(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof module==="object"&&module.exports){module.exports=function(b,c){if(c===undefined){if(typeof window!=="undefined"){c=require("jquery")}else{c=require("jquery")(b)}}a(c);return c}}else{a(jQuery)}}}(function(a){var b={$el:null,commentsById:{},currentSortKey:"",options:{profilePictureURL:"",spinnerIconURL:"",upvoteIconURL:"",replyIconURL:"",noCommentsIconURL:"",textareaPlaceholderText:"Add a comment",popularText:"Popular",newestText:"Newest",oldestText:"Oldest",sendText:"Send",replyText:"Reply",editText:"Edit",editedText:"Edited",youText:"You",saveText:"Save",deleteText:"Delete",viewAllRepliesText:"View all __replyCount__ replies",hideRepliesText:"Hide replies",noCommentsText:"No comments",textFormatter:function(c){return c},enableReplying:true,enableEditing:true,enableUpvoting:true,enableDeleting:true,enableDeletingCommentWithReplies:true,enableNavigation:true,defaultNavigationSortKey:"newest",highlightColor:"#337AB7",deleteButtonColor:"#C9302C",roundProfilePictures:false,textareaRows:2,textareaRowsOnFocus:2,textareaMaxRows:5,maxRepliesVisible:2,fieldMappings:{id:"id",parent:"parent",created:"created",modified:"modified",content:"content",fullname:"fullname",profilePictureURL:"profile_picture_url",createdByAdmin:"created_by_admin",createdByCurrentUser:"created_by_current_user",upvoteCount:"upvote_count",userHasUpvoted:"user_has_upvoted"},getComments:function(d,c){d([])},postComment:function(e,d,c){d(e)},putComment:function(e,d,c){d(e)},deleteComment:function(e,d,c){d()},upvoteComment:function(e,d,c){d(e)},refresh:function(){},timeFormatter:function(c){return new Date(c).toLocaleDateString()}},events:{"keydown [contenteditable]":"saveOnKeydown","focus [contenteditable]":"saveEditableContent","keyup [contenteditable]":"checkEditableContentForChange","paste [contenteditable]":"checkEditableContentForChange","input [contenteditable]":"checkEditableContentForChange","blur [contenteditable]":"checkEditableContentForChange","click .navigation li":"navigationElementClicked","click .commenting-field.main .textarea":"showMainCommentingField","click .commenting-field.main .close":"hideMainCommentingField","click .commenting-field .textarea":"increaseTextareaHeight","change .commenting-field .textarea":"increaseTextareaHeight textareaContentChanged","click .commenting-field:not(.main) .close":"removeCommentingField","click .commenting-field .send.enabled":"postComment","click .commenting-field .update.enabled":"putComment","click .commenting-field .delete.enabled":"deleteComment","click li.comment ul.child-comments .toggle-all":"toggleReplies","click li.comment button.reply":"replyButtonClicked","click li.comment button.edit":"editButtonClicked","click li.comment button.upvote":"upvoteComment"},init:function(c,d){this.$el=a(d);this.$el.addClass("jquery-comments");this.undelegateEvents();this.delegateEvents();(function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);if(a.browser.mobile){this.$el.addClass("mobile")}if(c.fieldMappings){c=a.extend({},c);a.extend(this.options.fieldMappings,c.fieldMappings);delete c.fieldMappings}a.extend(this.options,c);this.currentSortKey=this.options.defaultNavigationSortKey;this.createCssDeclarations();this.fetchDataAndRender()},delegateEvents:function(){this.bindEvents(false)},undelegateEvents:function(){this.bindEvents(true)},bindEvents:function(g){var i=g?"off":"on";for(var f in this.events){var d=f.split(" ")[0];var c=f.split(" ").slice(1).join(" ");var h=this.events[f].split(" ");for(var e in h){if(h.hasOwnProperty(e)){var j=this[h[e]];j=a.proxy(j,this);if(c==""){this.$el[i](d,j)}else{this.$el[i](d,c,j)}}}}},fetchDataAndRender:function(){var c=this;this.$el.empty();this.createHTML();this.commentsById={};var e=function(f){var g=f.map(function(h){return c.createCommentModel(h)});c.sortComments(g,"oldest");a(g).each(function(i,h){c.addCommentToDataModel(h)});c.render()};var d=function(){e([])};this.options.getComments(e,d)},createCommentModel:function(d){var c=this.applyInternalMappings(d);c.childs=[];return c},addCommentToDataModel:function(c){if(!(c.id in this.commentsById)){this.commentsById[c.id]=c;if(c.parent){var d=this.getOutermostParent(c.parent);d.childs.push(c.id)}}},updateCommentModel:function(c){a.extend(this.commentsById[c.id],c)},render:function(){var c=this;this.$el.find("#comment-list").remove();var d=a("<ul/>",{id:"comment-list"});var f=[];var e=[];a(this.getComments()).each(function(h,g){if(g.parent==null){f.push(g)}else{e.push(g)}});this.sortComments(f,this.currentSortKey);f.reverse();a(f).each(function(h,g){c.addComment(g,d)});this.sortComments(e,"oldest");a(e).each(function(h,g){c.addComment(g,d)});this.$el.find("> .spinner").remove();this.$el.find(".no-comments").before(d);this.options.refresh()},addComment:function(d,e){e=e||this.$el.find("#comment-list");var h=this.createCommentElement(d);if(d.parent){var g=e.find('.comment[data-id="'+d.parent+'"]');var c=g.parents(".comment").last();if(c.length==0){c=g}var f=c.find(".child-comments");f.append(h);this.updateToggleAllButton(c)}else{e.prepend(h)}},removeComment:function(h){var e=this;var f=this.commentsById[h];var c=this.getChildComments(f.id);a(c).each(function(k,l){e.removeComment(l.id)});if(f.parent){var g=this.getOutermostParent(f.parent);var d=g.childs.indexOf(f.id);g.childs.splice(d,1)}delete this.commentsById[h];var j=this.$el.find('li.comment[data-id="'+h+'"]');var i=j.parents("li.comment").last();j.remove();this.updateToggleAllButton(i)},updateToggleAllButton:function(f){var g=f.find(".child-comments");var c=g.find(".comment");var e=g.find("li.toggle-all");c.removeClass("hidden-reply");var i=c.slice(0,-this.options.maxRepliesVisible);i.addClass("hidden-reply");if(e.find("span.text").text()==this.options.textFormatter(this.options.hideRepliesText)){i.addClass("visible")}if(c.length>this.options.maxRepliesVisible){if(!e.length){e=a("<li/>",{"class":"toggle-all highlight-font-bold"});var d=a("<span/>",{"class":"text"});var h=a("<span/>",{"class":"caret"});e.append(d).append(h);g.prepend(e)}this.setToggleAllButtonText(e,false)}else{e.remove()}},sortComments:function(e,d){var c=this;if(d=="popularity"){e.sort(function(i,h){var g=i.childs.length;var f=h.childs.length;if(c.options.enableUpvoting){g+=i.upvoteCount;f+=h.upvoteCount}if(f!=g){return f-g}else{var k=new Date(i.created).getTime();var j=new Date(h.created).getTime();return j-k}})}else{e.sort(function(g,f){var i=new Date(g.created).getTime();var h=new Date(f.created).getTime();if(d=="newest"){return h-i}else{return i-h}})}},sortAndReArrangeComments:function(c){var d=this.$el.find("#comment-list");var e=this.getComments().filter(function(f){return !f.parent});this.sortComments(e,c);a(e).each(function(g,f){var h=d.find("> li.comment[data-id="+f.id+"]");d.append(h)})},saveOnKeydown:function(d){if(d.keyCode==13&&(d.metaKey||d.ctrlKey)){var c=a(d.currentTarget);c.siblings(".control-row").find(".save").trigger("click");d.stopPropagation();d.preventDefault()}},saveEditableContent:function(d){var c=a(d.currentTarget);c.data("before",c.html())},checkEditableContentForChange:function(d){var c=a(d.currentTarget);if(c.data("before")!=c.html()){c.data("before",c.html());c.trigger("change")}},navigationElementClicked:function(e){var d=a(e.currentTarget);d.siblings().removeClass("active");d.addClass("active");var c=d.data().sortKey;this.sortAndReArrangeComments(c);this.currentSortKey=c},showMainCommentingField:function(d){var c=a(d.currentTarget);c.siblings(".control-row").show();c.parent().find(".close").show();c.focus()},hideMainCommentingField:function(e){var c=a(e.currentTarget);var d=this.$el.find(".commenting-field.main .textarea");var f=this.$el.find(".commenting-field.main .control-row");this.clearTextarea(d);this.adjustTextareaHeight(d,false);f.hide();c.hide();d.blur()},increaseTextareaHeight:function(d){var c=a(d.currentTarget);this.adjustTextareaHeight(c,true)},textareaContentChanged:function(i){var k=a(i.currentTarget);var h=this.getTextareaContent(k);var f=k.siblings(".control-row").find(".save");if(!k.find(".reply-to-badge").length){var g=k.attr("data-comment");if(g){var m=k.parents("li.comment");if(m.length>1){var e=m.last().data("id");k.attr("data-parent",e)}}else{var e=k.parents("li.comment").last().data("id");k.attr("data-parent",e)}}var n=k.parents(".commenting-field").first();if(k[0].scrollHeight>k.outerHeight()){n.addClass("scrollable")}else{n.removeClass("scrollable")}var c=true;if(g=k.attr("data-comment")){var j=h!=this.commentsById[g].content;var d;if(this.commentsById[g].parent){d=this.commentsById[g].parent.toString()}var l=k.attr("data-parent")!=d;c=j||l}if(h.length&&c){f.addClass("enabled")}else{f.removeClass("enabled")}},removeCommentingField:function(f){var d=a(f.currentTarget);var c=d.siblings(".textarea");if(c.attr("data-comment")){d.parents("li.comment").first().removeClass("edit")}var e=d.parents(".commenting-field").first();e.remove()},postComment:function(f){var k=this;var i=a(f.currentTarget);var j=i.parents(".commenting-field").first();var g=j.find(".textarea");i.removeClass("enabled");var c=new Date().toISOString();var d={id:"c"+(this.getComments().length+1),parent:g.attr("data-parent")||null,created:c,modified:c,content:this.getTextareaContent(g),fullname:this.options.textFormatter(this.options.youText),profilePictureURL:this.options.profilePictureURL,createdByCurrentUser:true,upvoteCount:0,userHasUpvoted:false};d=this.applyExternalMappings(d);var h=function(m){var l=k.createCommentModel(m);k.addCommentToDataModel(l);k.addComment(l);j.find(".close").trigger("click")};var e=function(){i.addClass("enabled")};this.options.postComment(d,h,e)},putComment:function(g){var d=this;var h=a(g.currentTarget);var f=h.parents(".commenting-field").first();var c=f.find(".textarea");h.removeClass("enabled");var j=a.extend({},this.commentsById[c.attr("data-comment")]);a.extend(j,{parent:c.attr("data-parent")||null,content:this.getTextareaContent(c),modified:new Date().getTime()});j=this.applyExternalMappings(j);var i=function(l){var k=d.createCommentModel(l);delete k.childs;d.updateCommentModel(k);f.find(".close").trigger("click");d.reRenderComment(k.id)};var e=function(){h.addClass("enabled")};this.options.putComment(j,i,e)},deleteComment:function(g){var d=this;var j=a(g.currentTarget);var c=j.parents(".commenting-field").first().find(".textarea");var i=a.extend({},this.commentsById[c.attr("data-comment")]);var f=i.id;j.removeClass("enabled");i=this.applyExternalMappings(i);var h=function(){d.removeComment(f)};var e=function(){j.addClass("enabled")};this.options.deleteComment(i,h,e)},toggleReplies:function(d){var c=a(d.currentTarget);c.siblings(".hidden-reply").toggleClass("visible");this.setToggleAllButtonText(c,true)},replyButtonClicked:function(h){var g=a(h.currentTarget);var e=g.parents("li.comment").last();var i=g.parents(".comment").first().data().id;var f=e.find(".child-comments > .commenting-field");if(f.length){f.remove()}var d=f.find(".textarea").attr("data-parent");if(d!=i){f=this.createCommentingFieldElement(i);e.find(".child-comments").append(f);var c=f.find(".textarea");this.moveCursorToEnd(c)}},editButtonClicked:function(f){var g=a(f.currentTarget);var h=g.parents("li.comment").first();var e=h.data().model;h.addClass("edit");var d=this.createCommentingFieldElement(e.parent,e.id);h.find(".comment-wrapper").first().append(d);var c=d.find(".textarea");c.attr("data-comment",e.id);c.append(this.getTextareaContentAsEscapedHTML(e.content));this.moveCursorToEnd(c)},upvoteComment:function(h){var k=this;var e=a(h.currentTarget).parents("li.comment").first();var j=e.data().model;var c=j.upvoteCount;var f;if(j.userHasUpvoted){f=c-1}else{f=c+1}j.userHasUpvoted=!j.userHasUpvoted;j.upvoteCount=f;this.reRenderUpvotes(j.id);var d=a.extend({},j);d=this.applyExternalMappings(d);var i=function(m){var l=k.createCommentModel(m);k.updateCommentModel(l);k.reRenderUpvotes(l.id)};var g=function(){j.userHasUpvoted=!j.userHasUpvoted;j.upvoteCount=c;k.reRenderUpvotes(j.id)};this.options.upvoteComment(d,i,g)},createHTML:function(){var c=this;var e=this.createCommentingFieldElement();e.addClass("main");this.$el.append(e);var h=e.find(".control-row");h.hide();e.find(".close").hide();if(this.options.enableNavigation){this.$el.append(this.createNavigationElement())}var i=a("<div/>",{"class":"spinner"});var f=a("<i/>",{"class":"fa fa-spinner fa-spin"});if(this.options.spinnerIconURL.length){f.css("background-image",'url("'+this.options.spinnerIconURL+'")');f.addClass("image")}i.html(f);this.$el.append(i);var d=a("<div/>",{"class":"no-comments",text:this.options.textFormatter(this.options.noCommentsText)});var g=a("<i/>",{"class":"fa fa-comments fa-2x"});if(this.options.noCommentsIconURL.length){g.css("background-image",'url("'+this.options.noCommentsIconURL+'")');g.addClass("image")}d.prepend(a("<br/>")).prepend(g);this.$el.append(d)},createProfilePictureElement:function(d){var c=a("<img/>",{src:d,"class":"profile-picture"+(this.options.roundProfilePictures?" round":"")});return c},createCommentingFieldElement:function(i,e){var s=this;var r=a("<div/>",{"class":"commenting-field"});var m=this.createProfilePictureElement(this.options.profilePictureURL);m.addClass("by-current-user");var j=a("<div/>",{"class":"textarea-wrapper"});var d=a("<div/>",{"class":"control-row"});var q=a("<div/>",{"class":"textarea","data-placeholder":this.options.textFormatter(this.options.textareaPlaceholderText),contenteditable:true});this.adjustTextareaHeight(q,false);var c=a("<span/>",{"class":"close"}).append(a('<span class="left"/>')).append(a('<span class="right"/>'));if(e){var k=this.options.textFormatter(this.options.saveText);if(this.options.enableDeleting){var g=true;if(!this.options.enableDeletingCommentWithReplies){a(this.getComments()).each(function(t,u){if(u.parent==e){g=false}})}if(g){var n=a("<span/>",{"class":"enabled delete",text:this.options.textFormatter(this.options.deleteText)}).css("background-color",this.options.deleteButtonColor);d.append(n)}}}else{var k=this.options.textFormatter(this.options.sendText)}var p=e?"update":"send";var h=a("<span/>",{"class":p+" save highlight-background",text:k});d.prepend(h);j.append(c).append(q).append(d);r.append(m).append(j);if(i){q.attr("data-parent",i);var f=this.commentsById[i];if(f.parent){q.html("&nbsp;");var l=a("<input/>",{"class":"reply-to-badge highlight-font-bold",type:"button"});var o="@"+f.fullname;l.val(o);q.prepend(l)}}return r},createNavigationElement:function(){var f=a("<ul/>",{"class":"navigation"});var e=a("<li/>",{text:this.options.textFormatter(this.options.newestText),"data-sort-key":"newest"});var d=a("<li/>",{text:this.options.textFormatter(this.options.oldestText),"data-sort-key":"oldest"});var g=a("<li/>",{text:this.options.textFormatter(this.options.popularText),"data-sort-key":"popularity"});f.append(e).append(d);var c=this.options.enableReplying||this.options.enableUpvoting;if(c){f.append(g)}f.find("[data-sort-key="+this.currentSortKey+"]").addClass("active");return f},createCommentElement:function(d){var f=a("<li/>",{"data-id":d.id,"class":"comment"}).data("model",d);if(d.createdByCurrentUser){f.addClass("by-current-user")}if(d.createdByAdmin){f.addClass("by-admin")}var c=a("<ul/>",{"class":"child-comments"});var e=this.createCommentWrapperElement(d);f.append(e);if(d.parent==null){f.append(c)}return f},createCommentWrapperElement:function(r){var j=a("<div/>",{"class":"comment-wrapper"});var s=this.createProfilePictureElement(r.profilePictureURL);var f=a("<time/>",{text:this.options.timeFormatter(r.created),"data-original":r.created});var t=a("<div/>",{"class":"name",text:r.fullname});if(r.createdByAdmin){t.addClass("highlight-font-bold")}if(r.parent){var g=this.commentsById[r.parent];if(g.parent){var q=a("<span/>",{"class":"reply-to",text:g.fullname});var k=a("<i/>",{"class":"fa fa-share"});if(this.options.replyIconURL.length){k.css("background-image",'url("'+this.options.replyIconURL+'")');k.addClass("image")}q.prepend(k);t.append(q)}}var e=a("<div/>",{"class":"wrapper"});var p=a("<div/>",{"class":"content",text:r.content}).html(this.linkify(this.escape(r.content)));if(r.modified&&r.modified!=r.created){var h=this.options.timeFormatter(r.modified);var c=a("<time/>",{"class":"edited",text:this.options.textFormatter(this.options.editedText)+" "+h,"data-original":r.modified});p.append(c)}var i=a("<span/>",{"class":"actions"});var d=a("<span/>",{"class":"separator",text:"·"});var l=a("<button/>",{"class":"action reply",text:this.options.textFormatter(this.options.replyText)});var n=a("<i/>",{"class":"fa fa-thumbs-o-up"});if(this.options.upvoteIconURL.length){n.css("background-image",'url("'+this.options.upvoteIconURL+'")');n.addClass("image")}var o=this.createUpvoteElement(r);var m=a("<button/>",{"class":"action edit",text:this.options.textFormatter(this.options.editText)});if(this.options.enableReplying){i.append(l)}if(this.options.enableUpvoting){i.append(o)}if(this.options.enableEditing&&r.createdByCurrentUser){i.append(m)}i.children().each(function(u,v){if(!a(v).is(":last-child")){a(v).after(d.clone())}});e.append(p);e.append(i);j.append(s).append(f).append(t).append(e);return j},createUpvoteElement:function(e){var d=a("<i/>",{"class":"fa fa-thumbs-o-up"});if(this.options.upvoteIconURL.length){d.css("background-image",'url("'+this.options.upvoteIconURL+'")');d.addClass("image")}var c=a("<button/>",{"class":"action upvote"+(e.userHasUpvoted?" highlight-font":"")}).append(a("<span/>",{text:e.upvoteCount,"class":"upvote-count"})).append(d);return c},reRenderComment:function(f){var c=this.commentsById[f];var d=this.createCommentWrapperElement(c);var e=this.$el.find('li.comment[data-id="'+c.id+'"]');e.find("> .comment-wrapper").replaceWith(d)},reRenderUpvotes:function(f){var c=this.commentsById[f];var d=this.createUpvoteElement(c);var e=this.$el.find('li.comment[data-id="'+c.id+'"]');e.find(".upvote").first().replaceWith(d)},createCssDeclarations:function(){a("head style.jquery-comments-css").remove();this.createCss(".jquery-comments ul.navigation li.active:after {background: "+this.options.highlightColor+" !important;",+"}");this.createCss(".jquery-comments .highlight-background {background: "+this.options.highlightColor+" !important;",+"}");this.createCss(".jquery-comments .highlight-font {color: "+this.options.highlightColor+" !important;}");this.createCss(".jquery-comments .highlight-font-bold {color: "+this.options.highlightColor+" !important;font-weight: bold;}")},createCss:function(c){var d=a("<style/>",{type:"text/css","class":"jquery-comments-css",text:c});a("head").append(d)},getComments:function(){var c=this;return Object.keys(this.commentsById).map(function(d){return c.commentsById[d]})},getChildComments:function(c){return this.getComments().filter(function(d){return d.parent==c})},getOutermostParent:function(c){var e=c;do{var d=this.commentsById[e];e=d.parent}while(d.parent!=null);return d},setToggleAllButtonText:function(e,c){var d=this;var h=e.find("span.text");var i=e.find(".caret");var f=function(){var k=d.options.textFormatter(d.options.viewAllRepliesText);var j=e.siblings(".comment").length;k=k.replace("__replyCount__",j);h.text(k)};var g=this.options.textFormatter(this.options.hideRepliesText);if(c){if(h.text()==g){f()}else{h.text(g)}i.toggleClass("up")}else{if(h.text()!=g){f()}}},adjustTextareaHeight:function(e,d){var j=2.2;var g=1.45;var c=function(l){var k=j+(l-1)*g;e.css("height",k+"em")};e=a(e);var f=d==true?this.options.textareaRowsOnFocus:this.options.textareaRows;do{c(f);f++;var h=e[0].scrollHeight>e.outerHeight();var i=this.options.textareaMaxRows==false?false:f>this.options.textareaMaxRows}while(h&&!i)},clearTextarea:function(c){c.empty().trigger("input")},getTextareaContent:function(c){var d=a("<pre/>").html(c.html());d.find("div, p, br").replaceWith(function(){return"\n"+this.innerHTML});var e=d.text().replace(/^\s+/g,"");return e},getTextareaContentAsEscapedHTML:function(c){var d=this.escape(c);return d.replace(/(?:\n)/g,"<br>")},moveCursorToEnd:function(d){d=a(d)[0];a(d).trigger("input");a(d).scrollTop(d.scrollHeight);if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var c=document.createRange();c.selectNodeContents(d);c.collapse(false);var f=window.getSelection();f.removeAllRanges();f.addRange(c)}else{if(typeof document.body.createTextRange!="undefined"){var e=document.body.createTextRange();e.moveToElementText(d);e.collapse(false);e.select()}}d.focus()},escape:function(c){return a("<pre/>").text(c).html()},linkify:function(h){var c,k,g,f;k=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;c=h.replace(k,'<a href="$1" target="_blank">$1</a>');g=/(^|[^\/f])(www\.[\S]+(\b|$))/gim;c=c.replace(g,'$1<a href="http://$2" target="_blank">$2</a>');f=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;c=c.replace(f,'<a href="mailto:$1">$1</a>');var l=h.match(/<a href/g)||[];if(l.length>0){var e=h.split(/(<\/a>)/g);for(var j=0;j<e.length;j++){if(e[j].match(/<a href/g)==null){e[j]=e[j].replace(k,'<a href="$1" target="_blank">$1</a>').replace(g,'$1<a href="http://$2" target="_blank">$2</a>').replace(f,'<a href="mailto:$1">$1</a>')}}var d=e.join("");return d}else{return c}},applyInternalMappings:function(d){var c={};var f=this.options.fieldMappings;for(var e in f){if(f.hasOwnProperty(e)){c[f[e]]=e}}return this.applyMappings(c,d)},applyExternalMappings:function(c){var d=this.options.fieldMappings;return this.applyMappings(d,c)},applyMappings:function(g,f){var c={};for(var e in f){if(e in g){var d=g[e];c[d]=f[e]}}return c}};a.fn.comments=function(c){return this.each(function(){var d=Object.create(b);d.init(c||{},this);a.data(this,"comments",d)})}}));