(function(b){if("undefined"==typeof b){throw Error("jQuery should be loaded before CKEditor jQuery adapter.")}if("undefined"==typeof CKEDITOR){throw Error("CKEditor should be loaded before CKEditor jQuery adapter.")}CKEDITOR.config.jqueryOverrideVal="undefined"==typeof CKEDITOR.config.jqueryOverrideVal?!0:CKEDITOR.config.jqueryOverrideVal;b.extend(b.fn,{ckeditorGet:function(){var c=this.eq(0).data("ckeditorInstance");if(!c){throw"CKEditor is not initialized yet, use ckeditor() with a callback."}return c},ckeditor:function(d,i){if(!CKEDITOR.env.isCompatible){throw Error("The environment is incompatible.")}if(!b.isFunction(d)){var a=i;i=d;d=a}var c=[];i=i||{};this.each(function(){var e=b(this),m=e.data("ckeditorInstance"),k=e.data("_ckeditorInstanceLock"),j=this,g=new b.Deferred;c.push(g.promise());if(m&&!k){d&&d.apply(m,[this]),g.resolve()}else{if(k){m.once("instanceReady",function(){setTimeout(function f(){m.element?(m.element.$==j&&d&&d.apply(m,[j]),g.resolve()):setTimeout(f,100)},0)},null,null,9999)}else{if(i.autoUpdateElement||"undefined"==typeof i.autoUpdateElement&&CKEDITOR.config.autoUpdateElement){i.autoUpdateElementJquery=!0}i.autoUpdateElement=!1;e.data("_ckeditorInstanceLock",!0);m=b(this).is("textarea")?CKEDITOR.replace(j,i):CKEDITOR.inline(j,i);e.data("ckeditorInstance",m);m.on("instanceReady",function(f){var l=f.editor;setTimeout(function o(){if(l.element){f.removeListener();l.on("dataReady",function(){e.trigger("dataReady.ckeditor",[l])});l.on("setData",function(p){e.trigger("setData.ckeditor",[l,p.data])});l.on("getData",function(p){e.trigger("getData.ckeditor",[l,p.data])},999);l.on("destroy",function(){e.trigger("destroy.ckeditor",[l])});l.on("save",function(){b(j.form).submit();return !1},null,null,20);if(l.config.autoUpdateElementJquery&&e.is("textarea")&&b(j.form).length){var n=function(){e.ckeditor(function(){l.updateElement()})};b(j.form).submit(n);b(j.form).bind("form-pre-serialize",n);e.bind("destroy.ckeditor",function(){b(j.form).unbind("submit",n);b(j.form).unbind("form-pre-serialize",n)})}l.on("destroy",function(){e.removeData("ckeditorInstance")});e.removeData("_ckeditorInstanceLock");e.trigger("instanceReady.ckeditor",[l]);d&&d.apply(l,[j]);g.resolve()}else{setTimeout(o,100)}},0)},null,null,9999)}}});var h=new b.Deferred;this.promise=h.promise();b.when.apply(this,c).then(function(){h.resolve()});this.editor=this.eq(0).data("ckeditorInstance");return this}});CKEDITOR.config.jqueryOverrideVal&&(b.fn.val=CKEDITOR.tools.override(b.fn.val,function(a){return function(j){if(arguments.length){var g=this,h=[],i=this.each(function(){var e=b(this),m=e.data("ckeditorInstance");if(e.is("textarea")&&m){var k=new b.Deferred;m.setData(j,function(){k.resolve()});h.push(k.promise());return !0}return a.call(e,j)});if(h.length){var d=new b.Deferred;b.when.apply(this,h).done(function(){d.resolveWith(g)});return d.promise()}return i}var i=b(this).eq(0),l=i.data("ckeditorInstance");return i.is("textarea")&&l?l.getData():a.call(i)}}))})(window.jQuery);