jvm.Marker=function(a){var c,b;this.config=a;this.map=this.config.map;this.isImage=!!this.config.style.initial.image;this.createShape();c=this.getLabelText(a.index);if(this.config.label&&c){this.offsets=this.getLabelOffsets(a.index);this.labelX=a.cx/this.map.scale-this.map.transX;this.labelY=a.cy/this.map.scale-this.map.transY;this.label=a.canvas.addText({text:c,"data-index":a.index,dy:"0.6ex",x:this.labelX,y:this.labelY},a.labelStyle,a.labelsGroup);this.label.addClass("jvectormap-marker jvectormap-element")}};jvm.inherits(jvm.Marker,jvm.MapObject);jvm.Marker.prototype.createShape=function(){var a=this;if(this.shape){this.shape.remove()}this.shape=this.config.canvas[this.isImage?"addImage":"addCircle"]({"data-index":this.config.index,cx:this.config.cx,cy:this.config.cy},this.config.style,this.config.group);this.shape.addClass("jvectormap-marker jvectormap-element");if(this.isImage){jvm.$(this.shape.node).on("imageloaded",function(){a.updateLabelPosition()})}};jvm.Marker.prototype.updateLabelPosition=function(){if(this.label){this.label.set({x:this.labelX*this.map.scale+this.offsets[0]+this.map.transX*this.map.scale+5+(this.isImage?(this.shape.width||0)/2:this.shape.properties.r),y:this.labelY*this.map.scale+this.map.transY*this.map.scale+this.offsets[1]})}};jvm.Marker.prototype.setStyle=function(b,a){var c;jvm.Marker.parentClass.prototype.setStyle.apply(this,arguments);if(b==="r"){this.updateLabelPosition()}c=!!this.shape.get("image");if(c!=this.isImage){this.isImage=c;this.config.style=jvm.$.extend(true,{},this.shape.style);this.createShape()}};