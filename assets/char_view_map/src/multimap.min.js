jvm.MultiMap=function(b){var a=this;this.maps={};this.params=jvm.$.extend(true,{},jvm.MultiMap.defaultParams,b);this.params.maxLevel=this.params.maxLevel||Number.MAX_VALUE;this.params.main=this.params.main||{};this.params.main.multiMapLevel=0;this.history=[this.addMap(this.params.main.map,this.params.main)];this.defaultProjection=this.history[0].mapData.projection.type;this.mapsLoaded={};this.params.container.css({position:"relative"});this.backButton=jvm.$("<div/>").addClass("jvectormap-goback").text("Back").appendTo(this.params.container);this.backButton.hide();this.backButton.click(function(){a.goBack()});this.spinner=jvm.$("<div/>").addClass("jvectormap-spinner").appendTo(this.params.container);this.spinner.hide()};jvm.MultiMap.prototype={addMap:function(b,a){var c=jvm.$("<div/>").css({width:"100%",height:"100%"});this.params.container.append(c);this.maps[b]=new jvm.Map(jvm.$.extend(a,{container:c}));if(this.params.maxLevel>a.multiMapLevel){this.maps[b].container.on("regionClick.jvectormap",{scope:this},function(h,g){var d=h.data.scope,f=d.params.mapNameByCode(g,d);if(!d.drillDownPromise||d.drillDownPromise.state()!=="pending"){d.drillDown(f,g)}})}return this.maps[b]},downloadMap:function(c){var b=this,a=jvm.$.Deferred();if(!this.mapsLoaded[c]){jvm.$.get(this.params.mapUrlByCode(c,this)).then(function(){b.mapsLoaded[c]=true;a.resolve()},function(){a.reject()})}else{a.resolve()}return a},drillDown:function(b,e){var a=this.history[this.history.length-1],d=this,c=a.setFocus({region:e,animate:true}),f=this.downloadMap(e);c.then(function(){if(f.state()==="pending"){d.spinner.show()}});f.always(function(){d.spinner.hide()});this.drillDownPromise=jvm.$.when(f,c);this.drillDownPromise.then(function(){a.params.container.hide();if(!d.maps[b]){d.addMap(b,{map:b,multiMapLevel:a.params.multiMapLevel+1})}else{d.maps[b].params.container.show()}d.history.push(d.maps[b]);d.backButton.show()})},goBack:function(){var a=this.history.pop(),c=this.history[this.history.length-1],b=this;a.setFocus({scale:1,x:0.5,y:0.5,animate:true}).then(function(){a.params.container.hide();c.params.container.show();c.updateSize();if(b.history.length===1){b.backButton.hide()}c.setFocus({scale:1,x:0.5,y:0.5,animate:true})})}};jvm.MultiMap.defaultParams={mapNameByCode:function(a,b){return a.toLowerCase()+"_"+b.defaultProjection+"_en"},mapUrlByCode:function(a,b){return"jquery-jvectormap-data-"+a.toLowerCase()+"-"+b.defaultProjection+"-en.js"}};