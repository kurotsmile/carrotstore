CKEDITOR.dialog.add("pbckcodeDialog",function(a){var k=["1","2","4","8"],j,l=new PBSyntaxHighlighter(a.settings.highlighter),n,m,i;return{title:a.lang.pbckcode.title,minWidth:600,minHeight:400,contents:[{id:"editor",label:a.lang.pbckcode.editor,elements:[{type:"hbox",children:[{type:"select",id:"code-select",className:"cke_pbckcode_form",label:a.lang.pbckcode.mode,items:a.settings.modes,"default":a.settings.modes[0][1],setup:function(b){b&&(b=b.getAscendant("pre",!0),this.setValue(b.getAttribute("data-pbcklang")))},commit:function(b){b&&(b=b.getAscendant("pre",!0),b.setAttribute("data-pbcklang",this.getValue()))},onChange:function(){m.setMode("ace/mode/"+this.getValue())}},{type:"select",id:"code-tabsize-select",className:"cke_pbckcode_form",label:"Tab size",items:k,"default":k[2],setup:function(b){b&&(b=b.getAscendant("pre",!0),this.setValue(b.getAttribute("data-pbcktabsize")))},commit:function(b){b&&(b=b.getAscendant("pre",!0),b.setAttribute("data-pbcktabsize",this.getValue()))},onChange:function(b){b&&(i.convertIndentation(m," ",this.getValue()),m.setTabSize(this.getValue()))}}]},{type:"html",html:"<div></div>",id:"code-textarea",className:"cke_pbckcode_ace",style:"position: absolute; top: 80px; left: 10px; right: 10px; bottom: 50px;",setup:function(b){b=b.getHtml();b=b.replace(RegExp("<br/>","g"),"\n").replace(RegExp("<br>","g"),"\n").replace(RegExp("&lt;","g"),"<").replace(RegExp("&gt;","g"),">").replace(RegExp("&amp;","g"),"&").replace(RegExp("&nbsp;","g")," ");n.setValue(b)},commit:function(b){b.setText(n.getValue())}}]}],onLoad:function(){j=this;n=ace.edit(j.getContentElement("editor","code-textarea").getElement().getId());a.aceEditor=n;n.setTheme("ace/theme/"+a.settings.theme);n.setHighlightActiveLine(!0);m=n.getSession();m.setMode("ace/mode/"+a.settings.modes[0][1]);m.setTabSize(a.settings.tab_size);m.setUseSoftTabs(!0);i=ace.require("ace/ext/whitespace")},onShow:function(){var b=a.getSelection().getStartElement();b&&(b=b.getAscendant("pre",!0));!b||"pre"!==b.getName()?(b=new CKEDITOR.dom.element("pre"),"pre"!==l.getTag()&&b.append(new CKEDITOR.dom.element("code")),this.insertMode=!0):("pre"!==l.getTag()&&(b=b.getChild(0)),this.insertMode=!1);this.element=b;n.focus();n.setValue("");this.insertMode||this.setupContent(this.element)},onOk:function(){var b,d;b=d=this.element;this.insertMode?"pre"!==l.getTag()&&(d=this.element.getChild(0)):b=d.getAscendant("pre",!0);this.commitContent(d);l.setCls(b.getAttribute("data-pbcklang")+" "+a.settings.cls);d.setAttribute("class",l.getCls());this.insertMode&&a.insertElement(b)}}});CKEDITOR.dialog.on("resize",function(a){a=a.editor.aceEditor;void 0!==a&&a.resize()});